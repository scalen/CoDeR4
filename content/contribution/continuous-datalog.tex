\begin{nestedsection}{Continuous Datalog}{semantics}
	The first requirement of stream reasoning is a well-defined semantics.
	This must take into account the continuous nature of a subset of the base axioms of a stream reasoning problem, as well as its instantaneous truth and entailments, in line with the work of the reasoning community.
	However, it must also provide a continuous interpretation of those instantaneous entailments in order to integrate with other stream-processing technologies.
	More specifically, an appropriate semantics for stream reasoning on the semantic web must allow the expression of OWL 2 ontologies to some degree of expressivity, not sacrifice the precise semantics thereof whilst incorporating the semantics of stream processing, and allow for the continuous derivation of entailments in a concise manner.

	Continuous Datalog is the extension of positive Datalog with stream-processing semantics, with a view to accommodating the aims of the latter within the well-defined semantics of the former, which are shared with RIF-Core and therefore support reasoning at the expressivity of OWL 2 RL.
	This comprises the extension of Datalog programs to include sources of continuously generated/reported facts, and the application of sliding window semantics over those sources, thereby providing for the interpretation of Continuous Datalog programs as sequences of instantaneous states that are each valid positive Datalog programs.
	As such, these states each inherit the semantics of positive Datalog.
	Furthermore, it involves the continuous derivation of entailments from this sequence of instantaneous states as a set of streams of facts;
	these streams share a data model with the streams of continuous queries, as defined by the stream processing community, thereby allowing the integration of Continuous Datalog programs into stream processing pipelines.
	In addition, these streams may be trivially manipulated to retrieve the instantaneous sets of entailments produced by the more semantically well-defined offerings from the reasoning community, as proven in \refsec{semantics: proof for entailments}.

	In regards to Continuous Datalog, an ``instant'', a ``stream of facts'' and a ``sliding window'' over a stream are defined as follows:
	\begin{description}
		\item[Instant\label{def:continuous datalog: instant}]\hfill\\
			An instant is a discrete point in time.
			The continuous distance in time between these discrete points may be theoretically infinitesimal, but will in practise have a lower bound set by hardware limitations, or will be defined as part of some specific implementation.
			In these cases, anything that occurs between discrete instants is considered to have occurred at the next instant.
		\item[Stream of Facts\label{def:continuous datalog: stream}]\hfill\\
			A stream of facts is a \emph{sequence} of Datalog facts ordered by some temporal characteristic of each instance of each fact, e.g. the time at which each was entailment by some process at the source of the stream.
			Each instance of a fact is considered to be uniquely identifiable by the combination of its signature (its predicate $p$, subject $s$ and object $o$) and its entailment time $t$, so an instance is denoted ${p(s,o):t}$.
			This distinction between instances of facts within a stream is represented in Axiom~\ref{axiom:continuous datalog: window disjointness}.
			In practice, if two instances of the same fact also share an entailment time, they are considered to be the same instance.
		\item[Sliding Window\label{def:continuous datalog: window}]\hfill\\
			A sliding window of range ${X \in \mathbb{N}}$ over any stream $S$ at any given instant ${i \in \mathbb{N}}$ is the \emph{set} of instances of facts that occur in $S$ during the interval ${(i-X,i]}$, and is denoted ${W^{S,X}_{i}}$.
			The concept of a sliding window within the semantics of Continuous Datalog are further defined by Axioms~\ref{axiom:continuous datalog: window range leq 0} and~\ref{axiom:continuous datalog: window composition}.
	\end{description}
	The following axioms define the semantics of streams and windows over those streams in Continuous Datalog.
	\begin{enumerate}\newcounter{continuousDatalogAxioms}
		\item\label{axiom:continuous datalog: window range leq 0}
			A window of range ${X \leq 0}$ over any stream $S$ at any instant ${i \in \mathbb{N}}$ is always empty.
			\begin{equation*}
				W^{S,X}_{i} = \varnothing
			\end{equation*}
		\item\label{axiom:continuous datalog: window composition}
			A window of any range ${X \in \mathbb{N}}$ over any stream $S$ at any given instant ${i \in \mathbb{N}}$ is equivalent to the union of the $X$ consecutive windows of range 1 over the stream $S$ preceding and including that at instant $i$.
			\begin{equation*}
				W^{S,X}_{i} = \mathop{\cup}_{i=0}^{X-1} W^{S,1}_{i-i}
			\end{equation*}
		\item\label{axiom:continuous datalog: window disjointness}
			A window of any range ${X \in \mathbb{N}}$ over any stream $S$ at any instant ${i \in \mathbb{N}}$ is disjoint from a second window of any range ${Y \in \mathbb{N}}$ over $S$ at any instant after ${i - X}$.
			\begin{equation*}
				\forall X' \geq X \, \left( W^{S,X}_{i} \cap W^{S,Y}_{i-X'} = \varnothing \right)
			\end{equation*}
		% \item\label{axiom:continuous datalog: stream disjointness}
		% 	The contents of any two streams are disjoint, thus a window of any range ${X \in \mathbb{N}}$ over any stream $S$ at any instant ${i \in \mathbb{N}}$ is disjoint from a second window of any range ${Y \in \mathbb{N}}$ over any other stream ${Z \neq S}$ at any instant ${i \in \mathbb{N}}$.
		% 	\begin{equation*}
		% 		W^{S,X}_{i} \cap W^{Z,Y}_{i} = \varnothing
		% 	\end{equation*}
		\setcounter{continuousDatalogAxioms}{\theenumi}
	\end{enumerate}

	Given these definitions, a Continuous Datalog program may be formally defined, both in terms of streams and in terms of its instantaneous states:
	\begin{description}
		\item[Continuous Datalog Program\label{def:continuous datalog: CDP}]\hfill\\
			A Continuous Datalog Program (${CDP}$) is composed of a set of Positive Datalog axioms $A$, a set of streams of facts $S$ and the range ${R \in \mathbb{N}}$ of the windows over each stream in $S$.
			This specifies that the streamed data from $S$ is to be considered valid from its arrival for the duration represented by $R$.
			Such a continuous program entails a triple composed of the entailments of ${A \vDash A'}$, a stream of entailments $P$ and a stream of entailment negations $N$, whose contents are defined in Axioms~\ref{axiom:continuous datalog: positive window increment},~\ref{axiom:continuous datalog: negative window increment} and~\ref{axiom:continuous datalog: entailment precedes negation}.
			Streams $P$ and $N$ are therefore the continuous reasoning equivalents of the streams produced by the \emph{IStream} and \emph{DStream} operators of the \emph{CQL} continuous query language \citep{CQL} respectively.
			The truth value of a ${CDP}$ is instantaneous, with the the truth function of Continuous Datalog $T^{CD}$ taking both a program ${CDP}$ and an instant ${t \in \mathbb{N}}$ as arguments.
			\begin{equation*}
				CDP = \{A,S,R\} \vDash \{A',P,N\}
			\end{equation*}
		\item[State of a ${CDP}$\label{def:continuous datalog: CDPt}]\hfill\\
			The state of a ${CDP}$ at a given instant ${t \in \mathbb{N}}$ (${CDP_{i}}$) is the union of the axioms $A$ and the window $W^{S,R}_{i}$.
			As both $A$ and $W^{S,R}_{i}$ are sets of Datalog axioms, a ${CDP_{i}}$ constitutes a valid Datalog program that may be evaluated by the truth function of Datalog $T^{D}$, the result of which is the definition for the instantaneous truth of the ${CDP}$ at instant $t$ by $T^{CD}$.
			The instantaneous entailments of a $CDP_{i}$ are the union of the persistent entailments of ${A \vDash A'}$ (which are guaranteed to be entailed by every state, as Positive Datalog is monotonic) and the set $E_{i}$ of instances of the transient entailments that are justified at least in part by some subset of $W^{S,R}_{i}$. 
			\begin{equation*}
				T^{CD} \left( CDP, t \right) = T^{D} \left( CDP_{i} \right)
			\end{equation*}
			\begin{equation*}
				CDP_{i} = A \cup W^{S,R}_{i} \vDash A' \cup E_{i}
			\end{equation*}
	\end{description}
	The following axioms define the semantics of the streams of entailments $P$ and and negations $N$ of a ${CDP}$ in terms of the instantaneous entailments of the sequence of states of that continuous program.
	\begin{enumerate}\setcounter{enumi}{\thecontinuousDatalogAxioms}
		\item\label{axiom:continuous datalog: positive window increment}
			The window of range 1 at any given instant ${t \in \mathbb{N}}$ over the stream $P$ entailed by a ${CDP}$ is defined as the set of facts that are entailed by the state of the ${CDP}$ at instant $t$ that were not entailed by the state of ${CDP}$ at the previous instant instance ${t-1}$.
			\begin{equation*}
				W^{P,1}_{i} = \left( A' \cup E_{i} \right) \setminus \left( A' \cup E_{i-1} \right) = E_{i} \setminus E_{i-1}
			\end{equation*}
		\item\label{axiom:continuous datalog: negative window increment}
			The window of range 1 at any given instant ${t \in \mathbb{N}}$ over the stream $N$ entailed by a ${CDP}$ is defined as the set of facts that were entailed by the state of the ${CDP}$ at the previous instant instance ${t-1}$ that are no longer entailed by the state of ${CDP}$ at instant $t$.
			\begin{equation*}
				W^{N,1}_{i} = \left( A' \cup E_{i-1} \right) \setminus \left( A' \cup E_{i} \right) = E_{i-1} \setminus E_{i}
			\end{equation*}
		\item\label{axiom:continuous datalog: entailment precedes negation}
			Facts may only be negated by some part of their justification leaving the sliding window $W^{S,R}_{i}$, this necessarily being after they were entailed.
			As such, a window over the stream of entailments $P$ at any given instant ${t \in \mathbb{N}}$ will be disjoint from the 
			\begin{equation*}
				\forall Y \geq 1 \left( W^{P,1}_{i} \cap W^{N,1}_{i-Y} = \varnothing \right)
			\end{equation*}
		\setcounter{continuousDatalogAxioms}{\theenumi}
	\end{enumerate}

	From this, we can see that each instance $e$ of an entailment in some $E_{i}$ may take the same form as any other fact in a stream of facts, being ${e = p(s,o):t}$, where $t$ is the real time associated with the instant in which $e$ is first entailed by the ${CDP}$ (i.e. it appears in $E_{i}$ but not $E_{i-1}$, and so is part of $W^{P,1}_{i}$).
	As such, the stream of entailments $P$ of a ${CDP}$ takes the same form as the \emph{streams of facts} already described, thus producing a concise stream of entailments that may be read by further stream processing.
	In addition, the stream of negations $N$ of a ${CDP}$ also takes this form, but differs from the streams discussed thus far in that it is not ordered by the entailment time of the entailments but by the time at which they \emph{cease} to be entailed (i.e. they appear in $E_{i-1}$ but not $E_{i}$, and so are part of $W^{N,1}_{i}$).

	Thus far the translation from instantaneous sets of entailments to streams of entailments has been stated axiomatically as the definition of those streams.
	However, it is proven in \refapp{semantics: proof for entailments} that, from these axioms, it is also possible to reconstruct exactly the instantaneous set $E_{i}$ of entailment instances of any ${CDP}$ at any given instant from the windows of sufficient range over its entailed streams $P$ and $N$ at that instant.
	\[ \forall Y \geq X \geq R \, \left( E_{i} = W^{P,X}_{i} \setminus W^{N,Y}_{i} \right) \]
	The minimum range $X$ is such to achieve the \emph{complete} set of entailment instances $E_{i}$ of the ${CDP}_{i}$.
	In addition, the minimum range $Y$ is such to achieve the \emph{correct} set $E_{i}$.
	As such, a \emph{valid window} that contains only and exactly those instances of entailments in $E_{i}$ at every instant $i$ may be trivially maintained from the streams $P$ and $N$ continuously entailed by some ${CDP}$.
\end{nestedsection}